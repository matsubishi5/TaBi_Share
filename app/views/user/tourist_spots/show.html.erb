<h1>観光スポット詳細画面</h1>

<!-- 平均点計算 -->
<% @sum = 0 %>
<% @tourist_spot.reviews.each do |review| %>
  <% @sum += review.score %>
<% end %>
<%=  @sum / @tourist_spot.reviews.length %>
<!-- 平均点計算 -->

<% @tourist_spot.images.each do |image| %>
  <%= image_tag image.to_s %><br>
<% end %>

<%= label_tag :地名・施設名 %><br>
<%= @tourist_spot.name %><br>

<%= label_tag :紹介文 %><br>
<%= @tourist_spot.introduction %><br>

<%= label_tag :ジャンル %><br>
<%= @tourist_spot.genre.name %><br>

<%= label_tag :利用シーン %><br>
<%= @tourist_spot.scene.name %><br>

<%= label_tag :住所 %><br>
<%= @tourist_spot.full_address %><br>

<%= label_tag :アクセス %><br>
<%= @tourist_spot.access %><br>

<%= label_tag :営業時間 %><br>
<%= @tourist_spot.business_hour %><br>

<%= label_tag :駐車場 %><br>
<%= @tourist_spot.is_parking %><br>

<%= link_to  "レビュー投稿", new_user_tourist_spot_review_path(@tourist_spot) %><br>
<%= link_to  "レビュー一覧", user_tourist_spot_reviews_path(@tourist_spot) %><br>

<% if @tourist_spot.favorited_by?(current_user) %>
  <%= link_to "行きたい！から削除", user_tourist_spot_favorites_path(@tourist_spot), method: :delete %><br>
<% else %>
  <%= link_to "行きたい！", user_tourist_spot_favorites_path(@tourist_spot), method: :post %><br>
<% end %>

<% if @tourist_spot.wented_by?(current_user) %>
  <%= link_to "行った！から削除", user_tourist_spot_wents_path(@tourist_spot), method: :delete %><br>
<% else %>
  <%= link_to "行った！", user_tourist_spot_wents_path(@tourist_spot), method: :post %><br>
<% end %>

<% if @tourist_spot.user === current_user %>
<%= link_to "編集", edit_user_tourist_spot_path(@tourist_spot) %><br>
<%= link_to "削除", user_tourist_spot_path(@tourist_spot), method: :delete, data: { confirm: "本当に削除しますか？" } %>
<% end %>

<div id='map'></div>

<style>
#map {
  height: 600px;
  width: 600px;
}
</style>

<script>
let map

function initMap(){
  geocoder = new google.maps.Geocoder()

  map = new google.maps.Map(document.getElementById('map'), {
    center: {lat: <%= @tourist_spot.latitude %>, lng: <%= @tourist_spot.longitude %>},
    zoom: 12,
  });

  marker = new google.maps.Marker({
    position:  {lat: <%= @tourist_spot.latitude %>, lng: <%= @tourist_spot.longitude %>},
    map: map
  });
}
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCErCcqk6eIxWC2DG4pgYLGfgwnfpAjAVo&callback=initMap" async defer></script>

<%= link_to 'Twitterで共有', "https://twitter.com/share?url=#{request.url}&text=#{ @tourist_spot.name }を、Twitterでみんなに広めよう！", class: 'shareList__link icon-twitter', data: { show_count: false }, title: 'Twitter', target: '_blank' %>